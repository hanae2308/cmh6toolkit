<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“¤ CMH6 Newsletter Toolkit</title>
  <style>
    :root {
      --primary: #3a86ff;
      --secondary: #8338ec;
      --success: #06d6a0;
      --warning: #ffbe0b;
      --danger: #ff006e;
      --dark: #212529;
      --gray: #6c757d;
      --light-gray: #e9ecef;
      --white: #ffffff;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
      color: var(--dark);
      line-height: 1.4;
      font-size: 14px;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 1rem;
    }
    
    header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
    }
    
    h1 {
      color: var(--primary);
      font-size: 1.5rem;
      margin: 0.5rem 0;
      font-weight: 600;
    }
    
    .subtitle {
      color: var(--gray);
      font-size: 0.9rem;
      margin: 0;
    }
    
    .section {
      margin-bottom: 2rem;
      text-align: center;
    }
    
    .section-title {
	  padding-top: 30px;
      font-size: 1rem;
      color: var(--primary);
      margin: 0 0 1rem 0;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .tool-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0 rem;
      justify-items: center;
      margin: 0 auto;
      max-width: 700px;
    }
    
    .tool-card {
      background: var(--white);
      border-radius: 6px;
      padding: 0.8rem;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      transition: all 0.2s ease;
      cursor: pointer;
      border: 1px solid var(--light-gray);
      width: 100%;
      max-width: 200px;
      text-align: center;
    }
    
    .tool-card:hover {
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-color: var(--primary);
    }
    
    .tool-icon {
      color: var(--primary);
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }
    
    .tool-title {
      font-size: 0.95rem;
      margin: 0.3rem 0;
      color: var(--dark);
      font-weight: 500;
    }
    
    .tool-desc {
      color: var(--gray);
      font-size: 0.8rem;
      margin: 0;
    }
    
    /* Tool Section Styles */
    .tool-section {
      display: none;
      background: white;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      margin: 1.5rem auto;
      max-width: 700px;
      border: 1px solid var(--light-gray);
    }
    
    .tool-section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .back-btn {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 0.9rem;
      cursor: pointer;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.3rem 0;
    }
    
    .section-title {
      font-size: 1.2rem;
      color: var(--dark);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      justify-content: center;
    }
    
    .upload-area {
      border: 2px dashed #ced4da;
      border-radius: 8px;
      padding: 2rem 1rem;
      text-align: center;
      margin-bottom: 1rem;
      transition: all 0.3s;
    }
    
    .upload-area:hover {
      border-color: var(--primary);
    }
    
    .file-label {
      display: inline-block;
      padding: 0.6rem 1rem;
      background: #f0f5ff;
      border-radius: 6px;
      color: var(--primary);
      cursor: pointer;
      margin-top: 0.8rem;
      font-weight: 500;
      transition: all 0.3s;
      font-size: 0.8rem;
    }
    
    .file-label:hover {
      background: #e0ebff;
    }
    
    .file-input {
      display: none;
    }
    
    .action-btns {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-top: 1rem;
      justify-content: center;
    }
    
    .btn {
      display: inline-block;
      padding: 0.6rem 1rem;
      background: var(--primary);
      color: white;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 500;
      transition: background 0.3s;
      border: none;
      cursor: pointer;
      font-size: 0.8rem;
      min-width: 120px;
      text-align: center;
    }
    
    .btn:hover {
      background: #2a75e6;
    }
    
    .btn-secondary {
      background: var(--gray);
    }
    
    .btn-secondary:hover {
      background: #5a6268;
    }
    
    .btn-success {
      background: var(--success);
    }
    
    .btn-success:hover {
      background: #05a181;
    }
    
    .btn-warning {
      background: var(--warning);
    }
    
    .btn-warning:hover {
      background: #e6a700;
    }
    
    .btn-danger {
      background: var(--danger);
    }
    
    .btn-danger:hover {
      background: #d0006e;
    }
    
    textarea {
      width: 100%;
      min-height: 150px;
      padding: 0.8rem;
      border: 1px solid #ced4da;
      border-radius: 6px;
      font-family: inherit;
      margin-bottom: 1rem;
      font-size: 0.85rem;
    }
    
    .results-area {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
    }
    
    .message-info {
      margin: 0.5rem 0;
      padding: 0.8rem;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.85rem;
    }
    
    .download-link {
      display: block;
      margin: 0.3rem 0;
      font-weight: bold;
      color: #0066cc;
      text-decoration: none;
      font-size: 0.85rem;
    }
    
    .message-details {
      font-size: 0.75rem;
      color: #666;
      margin-top: 0.3rem;
    }
    
    #progress {
      margin: 0.5rem 0;
      display: none;
      text-align: center;
      font-size: 0.85rem;
    }
    
    .radio-group {
      display: flex;
      gap: 1rem;
      margin: 0.8rem 0;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .radio-option {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .radio-option input[type="radio"] {
      width: 16px;
      height: 16px;
      border: 2px solid var(--primary);
      border-radius: 50%;
      outline: none;
      cursor: pointer;
    }
    
    .radio-option input[type="radio"]:checked {
      background-color: var(--primary);
    }
    
    .radio-option label {
      font-size: 0.85rem;
      color: var(--dark);
      cursor: pointer;
    }
    
    footer {
      text-align: center;
      padding: 1rem 0;
      margin-top: 30rem;
      color: var(--gray);
      font-size: 0.7rem;
      border-top: 1px solid var(--light-gray);
    }

    @media (max-width: 600px) {
      .tool-grid {
        grid-template-columns: repeat(2, 1fr);
        max-width: 420px;
      }
      
      .tool-card {
        max-width: 180px;
      }
      
      .action-btns {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
      }
    }

    @media (max-width: 400px) {
      .tool-grid {
        grid-template-columns: 1fr;
        max-width: 220px;
      }
      
      .tool-card {
        max-width: 200px;
      }
    }

   
    .tab {
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.85rem;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      color: var(--gray);
    }
    
    .tab:hover {
      color: var(--primary);
    }
    
    .tab.active {
      border-bottom-color: var(--primary);
      color: var(--primary);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .input-section {
      margin-bottom: 1rem;
    }
    
    .input-section label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .input-hint {
      font-size: 0.75rem;
      color: var(--gray);
      margin-bottom: 0.5rem;
    }
    
    .output-container {
      border: 1px solid var(--light-gray);
      border-radius: 6px;
      margin-top: 1rem;
    }
    
    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background-color: var(--light-gray);
      border-bottom: 1px solid var(--light-gray);
    }
    
    .output-title {
      font-weight: 500;
      font-size: 0.85rem;
    }
    
    .output-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .result {
      padding: 1rem;
      font-family: monospace;
      font-size: 0.8rem;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }
    
    /* DNS Record Generator Specific Styles */
    .dns-tabs {
      display: flex;
      border-bottom: 1px solid var(--light-gray);
      background-color: #f8f9fa;
      margin-bottom: 1rem;
    }
    
    .dns-tab {
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.85rem;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      color: var(--gray);
    }
    
    .dns-tab:hover {
      color: var(--primary);
    }
    
    .dns-tab.active {
      border-bottom-color: var(--primary);
      color: var(--primary);
    }
    
    .dns-tab-content {
      display: none;
    }
    
    .dns-tab-content.active {
      display: block;
    }
    
    .record-item {
      padding: 0.5rem;
      margin-bottom: 0.375rem;
      background-color: white;
      border-radius: 4px;
      border-left: 2px solid var(--primary);
      font-family: 'Menlo', 'Monaco', 'Consolas', monospace;
      font-size: 0.75rem;
      word-break: break-all;
    }
    
    .record-item.error {
      border-left-color: var(--danger);
      background-color: rgba(255, 0, 110, 0.05);
    }
    
    .record-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.125rem;
      font-size: 0.7rem;
      color: var(--gray);
    }
    
    .record-type {
      font-weight: 500;
      color: var(--primary);
    }
    
    .record-type.error {
      color: var(--danger);
    }
    
    .record-domain {
      font-weight: 500;
    }
    
    .record-content {
      margin-top: 0.25rem;
    }
    
    .status {
      margin-top: 0.5rem;
      font-size: 0.75rem;
      padding: 0.5rem;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }
    
    .status i {
      font-size: 0.8rem;
    }
    
    .success {
      background-color: rgba(6, 214, 160, 0.1);
      color: var(--success);
    }
    
    .error {
      background-color: rgba(255, 0, 110, 0.1);
      color: var(--danger);
    }
    
    .warning {
      background-color: rgba(255, 190, 11, 0.1);
      color: var(--warning);
    }
    
    .info {
      background-color: rgba(58, 134, 255, 0.1);
      color: var(--primary);
    }
    
    .stats {
      display: flex;
      gap: 0.75rem;
      margin-top: 0.5rem;
      font-size: 0.75rem;
    }
    
    .stat-item {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      color: var(--gray);
    }
    
    .stat-value {
      font-weight: 500;
      color: var(--dark);
    }
    
    .stat-success {
      color: var(--success);
    }
    
    .stat-error {
      color: var(--danger);
    }
    
    .stat-warning {
      color: var(--warning);
    }
    
    /* Back to Top Button Styles */
    .back-to-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 50px;
      height: 50px;
      background: #4361ee;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      border: none;
    }
    
    .back-to-top:hover {
      background: #3f37c9;
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
    }
    
    .back-to-top.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .back-to-top i {
      transition: transform 0.3s;
    }
    
    .back-to-top:hover i {
      transform: translateY(-2px);
    }
    
    .back-to-top::after {
      content: "Refresh & Back to Top";
      position: absolute;
      right: 60px;
      white-space: nowrap;
      background: #4361ee;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      font-size: 0.9rem;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .back-to-top:hover::after {
      opacity: 1;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>CMH6 Newsletter Toolkit</h1>
      <p class="subtitle">Essential tools for newsletter processing</p>
    </header>
    
    <!-- Warmup Section -->
    <div class="section">
      <div class="section-title">Warmup</div>
      <div class="tool-grid">
        <div class="tool-card" data-tool="single-transformer">
          <div class="tool-icon"><i class="fas fa-envelope"></i></div>
          <h3 class="tool-title">Single Header Transformer</h3>
          <p class="tool-desc">Modify headers in individual newsletter source</p>
        </div>
        
        <div class="tool-card" data-tool="bulk-transformer">
          <div class="tool-icon"><i class="fas fa-envelopes-bulk"></i></div>
          <h3 class="tool-title">Bulk Header Transformer</h3>
          <p class="tool-desc">Modify headers across multiple newsletters</p>
        </div>
      </div>
    </div>
    
 <!-- Fixation Section -->
<div class="section">
  <div class="section-title">Fixation</div>
  <div class="tool-grid">
    <div class="tool-card" data-tool="single-remover">
      <div class="tool-icon"><i class="fas fa-envelope-open-text"></i></div>
      <h3 class="tool-title">Single Header Remover</h3>
      <p class="tool-desc">Remove headers from single newsletter</p>
    </div>
    
    <div class="tool-card" data-tool="bulk-remover">
      <div class="tool-icon"><i class="fas fa-trash-alt"></i></div>
      <h3 class="tool-title">Bulk Header Remover</h3>
      <p class="tool-desc">Remove multiple newsletter headers</p>
    </div>
    
    <div class="tool-card" data-tool="single-received-extractor">
      <div class="tool-icon"><i class="fas fa-code-branch"></i></div>
      <h3 class="tool-title">Single Received Extractor</h3>
      <p class="tool-desc">Extract Received headers from single email</p>
    </div>
    
    <div class="tool-card" data-tool="bulk-received-extractor">
      <div class="tool-icon"><i class="fas fa-network-wired"></i></div>
      <h3 class="tool-title">Bulk Received Extractor</h3>
      <p class="tool-desc">Extract Received headers from multiple emails</p>
    </div>
<div class="tool-card" data-tool="text-combiner">
  <div class="tool-icon"><i class="fas fa-file-alt"></i></div>
  <h3 class="tool-title">Text Combiner</h3>
  <p class="tool-desc">Combine multiple text files with SEP separators</p>
</div>
</div>

    
    <!-- Other Tools Section -->
    <div class="section">
      <div class="section-title">Other Tools</div>
      <div class="tool-grid">
        <div class="tool-card" data-tool="mbox-converter">
          <div class="tool-icon"><i class="fas fa-box-archive"></i></div>
          <h3 class="tool-title">MBOX Converter</h3>
          <p class="tool-desc">Convert MBOX to individual EML files</p>
        </div>
        
        <div class="tool-card" data-tool="domain-extractor">
          <div class="tool-icon"><i class="fas fa-globe"></i></div>
          <h3 class="tool-title">IP Domain Extractor</h3>
          <p class="tool-desc">Extract domains and IPs</p>
        </div>
        
        <div class="tool-card" data-tool="dns-generator">
          <div class="tool-icon"><i class="fas fa-server"></i></div>
          <h3 class="tool-title">DNS Record Generator</h3>
          <p class="tool-desc">Generate SPF and TXT records</p>
        </div>
      </div>
    </div>
    
    <!-- Tool Sections -->
    
    <!-- Single Email Header Transformer -->
    <div id="single-transformer" class="tool-section">
      <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to Tools</button>
      <h2 class="section-title"><i class="fas fa-envelope"></i> Single Newsletter Header Modifier</h2>
      
      <textarea id="singleInput" placeholder="Paste your newsletter source here..."></textarea>
      
      <div class="radio-group">
        <div class="radio-option">
          <input type="radio" id="singleRdns" name="singleReplace" value="RDNS" checked>
          <label for="singleRdns">Use [RDNS]</label>
        </div>
        <div class="radio-option">
          <input type="radio" id="singlePrpath" name="singleReplace" value="P_RPATH">
          <label for="singlePrpath">Use [P_RPATH]</label>
        </div>
      </div>
      
      <div class="action-btns">
        <button id="singleTransformBtn" class="btn"><i class="fas fa-magic"></i> Modify Headers</button>
        <button id="singleIpBtn" class="btn btn-warning"><i class="fas fa-plus"></i> Add [IP] to Subject</button>
        <button id="singleCopyBtn" class="btn btn-secondary"><i class="fas fa-copy"></i> Copy Output</button>
        <button id="singleClearBtn" class="btn btn-danger"><i class="fas fa-trash"></i> Clear All</button>
      </div>
      
      <textarea id="singleOutput" placeholder="Modified headers will appear here..." readonly></textarea>
    </div>
    
    <!-- Bulk Email Header Transformer -->
    <div id="bulk-transformer" class="tool-section">
      <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to Tools</button>
      <h2 class="section-title"><i class="fas fa-envelopes-bulk"></i> Bulk Newsletter Header Modifier</h2>
      
      <div class="upload-area" id="bulkUploadArea">
        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--success); margin-bottom: 0.8rem;"></i>
        <p>Drag and drop multiple .eml files or .zip archives here</p>
        <p>or</p>
        <label for="bulkFileInput" class="file-label">
          <i class="fas fa-folder-open"></i> Select Files
        </label>
        <input type="file" id="bulkFileInput" class="file-input" multiple accept=".eml,.zip">
      </div>
      
      <div class="radio-group">
        <div class="radio-option">
          <input type="radio" id="bulkRdns" name="bulkReplace" value="RDNS" checked>
          <label for="bulkRdns">Use [RDNS]</label>
        </div>
        <div class="radio-option">
          <input type="radio" id="bulkPrpath" name="bulkReplace" value="P_RPATH">
          <label for="bulkPrpath">Use [P_RPATH]</label>
        </div>
      </div>
      
      <div class="action-btns">
        <button id="bulkTransformBtn" class="btn"><i class="fas fa-magic"></i> Modify Headers</button>
        <button id="bulkIpBtn" class="btn btn-warning"><i class="fas fa-plus"></i> Add [IP] Tag</button>
        <button id="bulkTemplateBtn" class="btn btn-success"><i class="fas fa-file-alt"></i> Use Template</button>
      </div>
      
      <div class="template-container" id="bulkTemplateContainer" style="display: none; margin-top: 1.5rem;">
        <textarea id="bulkTemplateInput" placeholder="Enter your config here. Use [newsletter] where you want the modified newsletter to appear."></textarea>
        <button id="bulkProcessTemplateBtn" class="btn" style="margin-top: 1rem;"><i class="fas fa-cogs"></i> Process with Template</button>
      </div>
      
      <div class="results-area" id="bulkResults"></div>
    </div>
    
    <!-- MBOX Converter -->
    <div id="mbox-converter" class="tool-section">
      <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to Tools</button>
      <h2 class="section-title"><i class="fas fa-box-archive"></i> MBOX Converter</h2>
      
      <div class="info-message" style="margin-bottom: 1rem; font-size: 0.85rem; color: var(--gray);">
        <i class="fas fa-info-circle"></i> Download your newsletters from <a href="https://takeout.google.com/" target="_blank">Google Takeout</a>
      </div>
      
      <div class="upload-area" id="mboxUploadArea">
        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--warning); margin-bottom: 0.8rem;"></i>
        <p>Drag and drop an MBOX file or .zip archive here</p>
        <p>or</p>
        <label for="mboxFileInput" class="file-label">
          <i class="fas fa-folder-open"></i> Select File
        </label>
        <input type="file" id="mboxFileInput" class="file-input" accept=".mbox,.zip">
      </div>
      
      <div class="action-btns">
        <button id="mboxConvertBtn" class="btn"><i class="fas fa-exchange-alt"></i> Convert to EML</button>
      </div>
      
      <div id="progress" style="text-align: center;">
        Processing... <span id="progressCount">0</span> messages converted
      </div>
      
      <div class="results-area" id="mboxResults"></div>
      
      <button id="mboxDownloadAll" class="btn" style="display: none; margin-top: 1rem;">
        <i class="fas fa-file-archive"></i> Download All as ZIP
      </button>
    </div>
    
    <!-- Bulk Header Remover -->
    <div id="bulk-remover" class="tool-section">
      <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to Tools</button>
      <h2 class="section-title"><i class="fas fa-trash-alt"></i> Bulk Header Remover</h2>
      
      <div class="upload-area" id="removerUploadArea">
        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--danger); margin-bottom: 0.8rem;"></i>
        <p>Drag and drop multiple .eml files or .zip archives here</p>
        <p>or</p>
        <label for="removerFileInput" class="file-label">
          <i class="fas fa-folder-open"></i> Select Files
        </label>
        <input type="file" id="removerFileInput" class="file-input" multiple accept=".eml,.zip">
      </div>
      
      <div class="action-btns">
        <button id="removerTransformBtn" class="btn"><i class="fas fa-eraser"></i> Remove Headers</button>
        <button id="removerTemplateBtn" class="btn btn-success"><i class="fas fa-file-alt"></i> Use Template</button>
      </div>
      
      <div class="template-container" id="removerTemplateContainer" style="display: none; margin-top: 1.5rem;">
        <textarea id="removerTemplateInput" placeholder="Enter your config here. Use [newsletter] where you want the newsletter content to appear."></textarea>
        <button id="removerProcessTemplateBtn" class="btn" style="margin-top: 1rem;"><i class="fas fa-cogs"></i> Process with Template</button>
      </div>
      
      <div class="results-area" id="removerResults"></div>
    </div>
    
  <!-- Single Header Remover -->
<div id="single-remover" class="tool-section">
  <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to Tools</button>
  <h2 class="section-title"><i class="fas fa-envelope-open-text"></i> Single Header Remover</h2>
  
  <div class="input-section">
    <label for="singleRemoverInput">Newsletter Content</label>
    <textarea id="singleRemoverInput" placeholder="Paste your newsletter content here..."></textarea>
  </div>
  
  <div class="input-section">
    <label for="singleRemoverTemplate">Template (use [newsletter] where content should go)</label>
    <textarea id="singleRemoverTemplate" placeholder="Put your template here. Use [newsletter] where you want the newsletter body to appear."></textarea>
  </div>
  
  <div class="action-btns">
    <button id="singleRemoverBtn" class="btn"><i class="fas fa-eraser"></i> Remove Headers</button>
    <button id="singleRemoverCopyBtn" class="btn btn-secondary"><i class="fas fa-copy"></i> Copy Output</button>
    <button id="singleRemoverClearBtn" class="btn btn-danger"><i class="fas fa-trash-alt"></i> Clear All</button>
  </div>

  <!--  Output Containers -->
  <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
    <!-- Newsletter Body Output -->
    <div style="flex: 1; min-width: 0;">
      <div class="output-header">
        <div class="output-title">Newsletter body</div>
        <div class="output-actions">
          <button class="btn btn-secondary" style="padding: 0.3rem 0.5rem; font-size: 0.7rem;" id="copyNormalOutput">
            <i class="fas fa-copy"></i>
          </button>
        </div>
      </div>
      <div class="result" id="singleRemoverOutput" style="min-height: 200px;"></div>
    </div>
    
    <!-- Config + Newsletter Body Output -->
    <div style="flex: 1; min-width: 0;">
      <div class="output-header">
        <div class="output-title">Config + Newsletter body</div>
        <div class="output-actions">
          <button class="btn btn-secondary" style="padding: 0.3rem 0.5rem; font-size: 0.7rem;" id="copyTemplateOutput">
            <i class="fas fa-copy"></i>
          </button>
        </div>
      </div>
      <div class="result" id="singleRemoverTemplateOutput" style="min-height: 200px;"></div>
    </div>
  </div>

  <!-- Responsive behavior -->
  <style>
    @media (max-width: 768px) {
      #single-remover > div[style*="display: flex"] {
        flex-direction: column;
      }
    }
  </style>
</div>

<!-- Single Received Extractor -->
<div id="single-received-extractor" class="tool-section">
  <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to Tools</button>
  <h2 class="section-title"><i class="fas fa-code-branch"></i> Single Received Extractor</h2>
  
  <textarea id="singleReceivedInput" placeholder="Paste your email content here..."></textarea>
  
  <div class="action-btns">
    <button id="singleReceivedExtractBtn" class="btn"><i class="fas fa-code"></i> Extract Received Headers</button>
    <button id="singleReceivedCopyBtn" class="btn btn-secondary"><i class="fas fa-copy"></i> Copy</button>
    <button id="singleReceivedClearBtn" class="btn btn-danger"><i class="fas fa-trash-alt"></i> Clear</button>
  </div>
  
  <div class="output-container">
    <div class="output-header">
      <span class="output-title">Extracted Received Headers</span>
    </div>
    <div class="result" id="singleReceivedOutput"></div>
  </div>
</div>

<!-- Bulk Received Extractor -->
<div id="bulk-received-extractor" class="tool-section">
  <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to Tools</button>
  <h2 class="section-title"><i class="fas fa-network-wired"></i> Bulk Received Extractor</h2>
  
  <div class="upload-area" id="bulkReceivedUploadArea">
    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.8rem;"></i>
    <p>Drag and drop multiple .eml files or .zip archives here</p>
    <p>or</p>
    <label for="bulkReceivedFileInput" class="file-label">
      <i class="fas fa-folder-open"></i> Select Files
    </label>
    <input type="file" id="bulkReceivedFileInput" class="file-input" multiple accept=".eml,.zip">
  </div>
  
  <div class="action-btns">
    <button id="bulkReceivedExtractBtn" class="btn"><i class="fas fa-code"></i> Extract Received Headers</button>
    <button id="bulkReceivedDownloadBtn" class="btn btn-success"><i class="fas fa-download"></i> Download All</button>
    <button id="bulkReceivedClearBtn" class="btn btn-danger"><i class="fas fa-trash-alt"></i> Clear</button>
  </div>
  
  <div class="results-area" id="bulkReceivedResults"></div>
</div>
    <!-- Add this with the other tool sections -->
<div id="text-combiner" class="tool-section">
  <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to Tools</button>
  <h2 class="section-title"><i class="fas fa-file-alt"></i> Text Combiner</h2>
  
  <div class="upload-area" id="combinerUploadArea">
    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.8rem;"></i>
    <p>Drag and drop multiple text files or .zip archive here</p>
    <p>or</p>
    <label for="combinerFileInput" class="file-label">
      <i class="fas fa-folder-open"></i> Select Files
    </label>
    <input type="file" id="combinerFileInput" class="file-input" multiple accept=".txt,.zip">
  </div>
  
  <div class="action-btns">
    <button id="combineBtn" class="btn"><i class="fas fa-object-group"></i> Combine Files</button>
    <button id="combinerClearBtn" class="btn btn-danger"><i class="fas fa-trash-alt"></i> Clear</button>
  </div>
  
  <div class="results-area" id="combinerResults"></div>
</div>
    <!-- Domain & IP Extractor -->
    <div id="domain-extractor" class="tool-section">
      <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to Tools</button>
      <h2 class="section-title"><i class="fas fa-globe"></i> Domain & IP Extractor</h2>
      
      <textarea id="domainExtractorInput" placeholder="Paste your text with domains and IPs here..."></textarea>
      
      <div class="action-btns">
        <button id="domainExtractorBtn" class="btn"><i class="fas fa-search"></i> Extract</button>
        <button id="domainExtractorCopyBtn" class="btn btn-secondary"><i class="fas fa-copy"></i> Copy</button>
        <button id="domainExtractorClearBtn" class="btn btn-danger"><i class="fas fa-trash-alt"></i> Clear</button>
      </div>
      
      <div class="output-container" style="margin-top: 1.5rem;">
        <div class="output-header">
          <div class="output-title">Extracted Domains & IPs</div>
        </div>
        <div class="result" id="domainExtractorOutput"></div>
      </div>
    </div>
    
    <!-- DNS Record Generator -->
    <div id="dns-generator" class="tool-section">
      <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to Tools</button>
      <h2 class="section-title"><i class="fas fa-server"></i> DNS Record Generator</h2>
      
      <div class="dns-tabs">
        <div class="dns-tab active" data-tab="spf">SPF Intern</div>
        <div class="dns-tab" data-tab="spf-external">SPF Extern</div>
        <div class="dns-tab" data-tab="txt">TXT Generator</div>
      </div>
      
      <!-- SPF Generator Tab -->
      <div id="spf-tab" class="dns-tab-content active">
        <div class="form-grid">
          <div class="input-section">
            <label for="spf-domains">Domains</label>
            <textarea id="spf-domains" placeholder="example.com&#10;example.org&#10;example.net"></textarea>
          </div>
          
          <div class="input-section">
            <label for="spf-ips">IP Addresses</label>
            <textarea id="spf-ips" placeholder="192.168.1.1 192.168.1.2 192.168.1.3"></textarea>
          </div>
        </div>
        
        <div class="action-btns">
          <button class="btn" onclick="generateSpfRecords()">
            <i class="fas fa-magic"></i>
            Generate
          </button>
          <button class="btn btn-secondary" onclick="clearSpfInputs()">
            <i class="fas fa-trash-alt"></i>
            Clear
          </button>
        </div>
        
        <div class="output-section">
          <div class="output-container">
            <div class="output-header">
              <span class="output-title">Generated SPF Records</span>
              <div class="output-actions">
                <button class="btn btn-secondary" style="padding: 0.3rem 0.5rem; font-size: 0.7rem;" onclick="copySpfToClipboard()">
                  <i class="far fa-copy"></i>
                  Copy
                </button>
                <button class="btn btn-secondary" style="padding: 0.3rem 0.5rem; font-size: 0.7rem;" onclick="downloadSpfRecords()">
                  <i class="fas fa-download"></i>
                  Save
                </button>
              </div>
            </div>
            <div class="result" id="spf-result"></div>
          </div>
          <div id="spf-stats" class="stats"></div>
          <div id="spf-statusMessage" class="status info">
            <i class="fas fa-info-circle"></i>
            <span>Ready to generate SPF records</span>
          </div>
        </div>
      </div>
      
      <!-- SPF External Generator Tab -->
      <div id="spf-external-tab" class="dns-tab-content">
        <div class="form-grid">
          <div class="input-section">
            <label for="spf-external-domains">Domains</label>
            <textarea id="spf-external-domains" placeholder="example.com&#10;example.org&#10;example.net"></textarea>
          </div>
          
          <div class="input-section">
            <label for="spf-external-ips">IP Addresses</label>
            <textarea id="spf-external-ips" placeholder="192.168.1.1 192.168.1.2 192.168.1.3"></textarea>
          </div>
        </div>
        
        <div class="action-btns">
          <button class="btn" onclick="generateSpfExternalRecords()">
            <i class="fas fa-magic"></i>
            Generate
          </button>
          <button class="btn btn-secondary" onclick="clearSpfExternalInputs()">
            <i class="fas fa-trash-alt"></i>
            Clear
          </button>
        </div>
        
        <div class="output-section">
          <div class="output-container">
            <div class="output-header">
              <span class="output-title">Generated SPF Records </span>
              <div class="output-actions">
                <button class="btn btn-secondary" style="padding: 0.3rem 0.5rem; font-size: 0.7rem;" onclick="copySpfExternalToClipboard()">
                  <i class="far fa-copy"></i>
                  Copy
                </button>
                <button class="btn btn-secondary" style="padding: 0.3rem 0.5rem; font-size: 0.7rem;" onclick="downloadSpfExternalRecords()">
                  <i class="fas fa-download"></i>
                  Save
                </button>
              </div>
            </div>
            <div class="result" id="spf-external-result"></div>
          </div>
          <div id="spf-external-stats" class="stats"></div>
          <div id="spf-external-statusMessage" class="status info">
            <i class="fas fa-info-circle"></i>
            <span>Ready to generate Extern SPF records </span>
          </div>
        </div>
      </div>
      
      <!-- TXT Generator Tab -->
      <div id="txt-tab" class="dns-tab-content">
        <div class="input-section">
          <label for="txt-input">Input Domains</label>
          <p class="input-hint">Domain followed by verification data (one per line)</p>
          <textarea id="txt-input" placeholder="example.com google-site-verification=WwDCrnKEvovHoV_V00sL02Vc__5ktTCx9SByZ1ciT0g"></textarea>
        </div>
        
        <div class="action-btns">
          <button class="btn" onclick="generateTxtRecords()">
            <i class="fas fa-magic"></i>
            Generate
          </button>
          <button class="btn btn-secondary" onclick="clearTxtInputs()">
            <i class="fas fa-trash-alt"></i>
            Clear
          </button>
        </div>
        
        <div class="output-section">
          <div class="output-container">
            <div class="output-header">
              <span class="output-title">Generated TXT Records</span>
              <div class="output-actions">
                <button class="btn btn-secondary" style="padding: 0.3rem 0.5rem; font-size: 0.7rem;" onclick="copyTxtToClipboard()">
                  <i class="far fa-copy"></i>
                  Copy
                </button>
                <button class="btn btn-secondary" style="padding: 0.3rem 0.5rem; font-size: 0.7rem;" onclick="downloadTxtRecords()">
                  <i class="fas fa-download"></i>
                  Save
                </button>
              </div>
            </div>
            <div class="result" id="txt-result"></div>
          </div>
          <div id="txt-stats" class="stats"></div>
          <div id="txt-statusMessage" class="status info">
            <i class="fas fa-info-circle"></i>
            <span>Ready to generate TXT records</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Back to Top Button with Refresh Functionality -->
    <button class="back-to-top" id="backToTopBtn" title="Refresh & Back to Top">
      <i class="fas fa-sync-alt"></i>
    </button>

    <footer>
      <p><strong>CMH6 Newsletter Toolkit</strong></p>
      <p>Created by Hanae HM & CMH6 Team</p>
    </footer>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
  // =============================================
// TOOL NAVIGATION AND UTILITIES
// =============================================
const toolCards = document.querySelectorAll('.tool-card');
const toolSections = document.querySelectorAll('.tool-section');
const backButtons = document.querySelectorAll('.back-btn');

function clearToolData(toolId) {
  switch(toolId) {
    case 'single-transformer':
      document.getElementById('singleInput').value = '';
      document.getElementById('singleOutput').value = '';
      break;
    case 'bulk-transformer':
      document.getElementById('bulkFileInput').value = '';
      document.getElementById('bulkResults').innerHTML = '';
      document.getElementById('bulkTemplateInput').value = '';
      document.getElementById('bulkTemplateContainer').style.display = 'none';
      break;
    case 'mbox-converter':
      document.getElementById('mboxFileInput').value = '';
      document.getElementById('mboxResults').innerHTML = '';
      document.getElementById('mboxDownloadAll').style.display = 'none';
      break;
    case 'bulk-remover':
      document.getElementById('removerFileInput').value = '';
      document.getElementById('removerResults').innerHTML = '';
      document.getElementById('removerTemplateInput').value = '';
      document.getElementById('removerTemplateContainer').style.display = 'none';
      break;
    case 'single-remover':
      document.getElementById('singleRemoverInput').value = '';
      document.getElementById('singleRemoverTemplate').value = '';
      document.getElementById('singleRemoverOutput').textContent = '';
      document.getElementById('singleRemoverTemplateOutput').textContent = '';
      break;
    case 'domain-extractor':
      document.getElementById('domainExtractorInput').value = '';
      document.getElementById('domainExtractorOutput').textContent = '';
      break;
    case 'dns-generator':
      document.getElementById('spf-domains').value = '';
      document.getElementById('spf-ips').value = '';
      document.getElementById('spf-result').innerHTML = '';
      document.getElementById('spf-stats').innerHTML = '';
      document.getElementById('spf-statusMessage').innerHTML = '<i class="fas fa-info-circle"></i><span>Ready to generate SPF records</span>';
      document.getElementById('spf-statusMessage').className = 'status info';
      
      document.getElementById('spf-external-domains').value = '';
      document.getElementById('spf-external-ips').value = '';
      document.getElementById('spf-external-result').innerHTML = '';
      document.getElementById('spf-external-stats').innerHTML = '';
      document.getElementById('spf-external-statusMessage').innerHTML = '<i class="fas fa-info-circle"></i><span>Ready to generate SPF records in external format</span>';
      document.getElementById('spf-external-statusMessage').className = 'status info';
      
      document.getElementById('txt-input').value = '';
      document.getElementById('txt-result').innerHTML = '';
      document.getElementById('txt-stats').innerHTML = '';
      document.getElementById('txt-statusMessage').innerHTML = '<i class="fas fa-info-circle"></i><span>Ready to generate TXT records</span>';
      document.getElementById('txt-statusMessage').className = 'status info';
      break;
    case 'single-received-extractor':
      document.getElementById('singleReceivedInput').value = '';
      document.getElementById('singleReceivedOutput').textContent = '';
      break;
    case 'bulk-received-extractor':
      document.getElementById('bulkReceivedFileInput').value = '';
      document.getElementById('bulkReceivedResults').innerHTML = '';
      break;
    case 'text-combiner':
      document.getElementById('combinerFileInput').value = '';
      document.getElementById('combinerResults').innerHTML = '';
      break;
  }
}

toolCards.forEach(card => {
  card.addEventListener('click', function() {
    const toolId = this.getAttribute('data-tool');
    
    toolSections.forEach(section => {
      section.classList.remove('active');
    });
    
    document.getElementById(toolId).classList.add('active');
    document.getElementById(toolId).scrollIntoView({
      behavior: 'smooth'
    });
  });
});

backButtons.forEach(button => {
  button.addEventListener('click', function() {
    const activeSection = document.querySelector('.tool-section.active');
    if (activeSection) {
      clearToolData(activeSection.id);
    }
    
    toolSections.forEach(section => {
      section.classList.remove('active');
    });
    
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });
});

function showButtonFeedback(button, message, duration = 2000) {
  const originalText = button.innerHTML;
  button.innerHTML = `<i class="fas fa-check"></i> ${message}`;
  button.disabled = true;
  
  setTimeout(() => {
    button.innerHTML = originalText;
    button.disabled = false;
  }, duration);
}

// =============================================
// SINGLE EMAIL HEADER TRANSFORMER
// =============================================
function initSingleTransformer() {
  const transformBtn = document.getElementById('singleTransformBtn');
  const ipBtn = document.getElementById('singleIpBtn');
  const copyBtn = document.getElementById('singleCopyBtn');
  const clearBtn = document.getElementById('singleClearBtn');
  const inputText = document.getElementById('singleInput');
  const outputText = document.getElementById('singleOutput');

  transformBtn.addEventListener('click', () => {
    transformHeaders(false);
    showButtonFeedback(transformBtn, "Done!");
  });

  ipBtn.addEventListener('click', () => {
    transformHeaders(true);
    showButtonFeedback(ipBtn, "Done!");
  });

  copyBtn.addEventListener('click', () => {
    if (!outputText.value) {
      showButtonFeedback(copyBtn, "Nothing to copy!");
      return;
    }
    outputText.select();
    document.execCommand("copy");
    showButtonFeedback(copyBtn, "Copied!");
  });

  clearBtn.addEventListener('click', () => {
    inputText.value = '';
    outputText.value = '';
    showButtonFeedback(clearBtn, "Cleared!");
  });

  function transformHeaders(addIP) {
    let input = inputText.value;
    if (!input.trim()) {
      showButtonFeedback(transformBtn, "Paste headers first!");
      return;
    }

    const replacement = document.querySelector('input[name="singleReplace"]:checked').value;
    
    const returnPathIndex = input.indexOf('Return-Path:');
    if (returnPathIndex !== -1) {
      const nextNewLine = input.indexOf('\n', returnPathIndex);
      input = input.substring(nextNewLine + 1);
    }

    let output = input;

    output = output.replace(/(From:\s*.*?<[^@<\s]+)@[^>\s]+/gi, `$1@[${replacement}]`);
    output = output.replace(/(From:\s*[^<\s@]+)@([^\s]+)/gi, `$1@[${replacement}]`);
    output = output.replace(/(Sender:\s*.*?<[^@<\s]+)@[^>\s]+/gi, `$1@[${replacement}]`);
    output = output.replace(/(Sender:\s*[^<\s@]+)@([^\s]+)/gi, `$1@[${replacement}]`);

    output = output.replace(/(Message-ID:\s*<)([^@]+)(@[^>]+>)/gi, function(_, prefix, id, suffix) {
      const pos = Math.max(1, Math.floor(Math.random() * id.length));
      return prefix + id.slice(0, pos) + '[EID]' + id.slice(pos) + suffix;
    });

    if (addIP) {
      output = output.replace(/^(Subject:.*?)$/im, function(_, subject) {
        return subject.includes('[IP]') ? subject : subject + ' [IP]';
      });
    }

    outputText.value = output;
  }
}

// =============================================
// BULK EMAIL HEADER TRANSFORMER
// =============================================
function initBulkTransformer() {
  const dropArea = document.getElementById('bulkUploadArea');
  const fileInput = document.getElementById('bulkFileInput');
  const transformBtn = document.getElementById('bulkTransformBtn');
  const ipBtn = document.getElementById('bulkIpBtn');
  const templateBtn = document.getElementById('bulkTemplateBtn');
  const templateContainer = document.getElementById('bulkTemplateContainer');
  const processTemplateBtn = document.getElementById('bulkProcessTemplateBtn');
  const resultsArea = document.getElementById('bulkResults');

  let filesToProcess = [];

  templateBtn.addEventListener('click', () => {
    templateContainer.style.display = templateContainer.style.display === 'block' ? 'none' : 'block';
    showButtonFeedback(templateBtn, templateContainer.style.display === 'block' ? "Template Shown" : "Template Hidden");
  });

  ["dragenter", "dragover"].forEach(event => {
    dropArea.addEventListener(event, e => {
      e.preventDefault();
      e.stopPropagation();
      dropArea.classList.add("dragover");
    });
  });

  ["dragleave", "drop"].forEach(event => {
    dropArea.addEventListener(event, e => {
      e.preventDefault();
      e.stopPropagation();
      dropArea.classList.remove("dragover");
    });
  });

  dropArea.addEventListener("drop", e => {
    e.preventDefault();
    e.stopPropagation();
    fileInput.files = e.dataTransfer.files;
    handleFileSelection();
  });

  fileInput.addEventListener("change", handleFileSelection);

  async function handleFileSelection() {
    filesToProcess = [];
    const files = Array.from(fileInput.files);
    
    if (files.length === 0) {
      resultsArea.innerHTML = '<p>No files selected</p>';
      return;
    }

    resultsArea.innerHTML = '<p>Processing files...</p>';
    
    try {
      for (const file of files) {
        if (file.name.endsWith('.zip')) {
          const zip = await JSZip.loadAsync(file);
          for (const [relativePath, zipEntry] of Object.entries(zip.files)) {
            if (!zipEntry.dir && (zipEntry.name.endsWith('.eml') || zipEntry.name.endsWith('.txt'))) {
              const content = await zipEntry.async('text');
              filesToProcess.push({
                name: zipEntry.name.split('/').pop(),
                content: content
              });
            }
          }
        } else if (file.name.endsWith('.eml') || file.name.endsWith('.txt')) {
          const content = await file.text();
          filesToProcess.push({
            name: file.name,
            content: content
          });
        }
      }

      updateFileList();
      showButtonFeedback(transformBtn, `${filesToProcess.length} files ready`);
    } catch (error) {
      resultsArea.innerHTML = `<p style="color:red;">Error processing files: ${error.message}</p>`;
      console.error(error);
    }
  }

  function updateFileList() {
    if (filesToProcess.length === 0) {
      resultsArea.innerHTML = '<p>No valid EML or TXT files found</p>';
      return;
    }

    resultsArea.innerHTML = `
      <p><strong>Selected files:</strong> ${filesToProcess.length}</p>
      <ul style="margin-top: 0.5rem; max-height: 200px; overflow-y: auto;">
        ${filesToProcess.map(file => `<li>${file.name}</li>`).join('')}
      </ul>
    `;
  }

  function transformContent(content, addIP) {
    const replacement = document.querySelector('input[name="bulkReplace"]:checked').value;
    
    if (!content.includes('Return-Path:') && !content.includes('From:')) {
      return content;
    }

    const returnPathIndex = content.indexOf('Return-Path:');
    if (returnPathIndex !== -1) {
      const nextNewLine = content.indexOf('\n', returnPathIndex);
      content = content.substring(nextNewLine + 1);
    }

    let output = content;

    output = output.replace(/(From:\s*.*?<[^@<\s]+)@[^>\s]+/gi, `$1@[${replacement}]`);
    output = output.replace(/(From:\s*[^<\s@]+)@([^\s]+)/gi, `$1@[${replacement}]`);
    output = output.replace(/(Sender:\s*.*?<[^@<\s]+)@[^>\s]+/gi, `$1@[${replacement}]`);
    output = output.replace(/(Sender:\s*[^<\s@]+)@([^\s]+)/gi, `$1@[${replacement}]`);

    if (output.includes('Message-ID:')) {
      output = output.replace(/(Message-ID:\s*<)([^@]+)(@[^>]+>)/gi, (_, prefix, id, suffix) => {
        const pos = Math.max(1, Math.floor(Math.random() * id.length));
        return prefix + id.slice(0, pos) + '[EID]' + id.slice(pos) + suffix;
      });
    }

    if (addIP && output.includes('Subject:')) {
      output = output.replace(/^(Subject:.*?)$/im, (_, subject) =>
        subject.includes('[IP]') ? subject : subject + ' [IP]'
      );
    }

    return output;
  }

  async function processFiles(addIP) {
    if (filesToProcess.length === 0) {
      showButtonFeedback(transformBtn, "Upload files first!");
      return;
    }

    try {
      const zip = new JSZip();
      
      for (const file of filesToProcess) {
        const output = transformContent(file.content, addIP);
        zip.file(file.name, output);
      }

      const blob = await zip.generateAsync({ type: "blob" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "transformed_headers.zip";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showButtonFeedback(transformBtn, "Downloaded!");
    } catch (error) {
      showButtonFeedback(transformBtn, "Error occurred!");
      console.error(error);
    }
  }

  async function processWithTemplate() {
    if (filesToProcess.length === 0) {
      showButtonFeedback(processTemplateBtn, "Upload files first!");
      return;
    }

    const template = document.getElementById("bulkTemplateInput").value;
    if (!template) {
      showButtonFeedback(processTemplateBtn, "Enter template first!");
      return;
    }

    if (!template.includes("[newsletter]")) {
      showButtonFeedback(processTemplateBtn, 'Add "[newsletter]"!');
      return;
    }

    try {
      const zip = new JSZip();
      
      for (const file of filesToProcess) {
        const transformedContent = transformContent(file.content, false);
        const finalContent = template.replace("[newsletter]", transformedContent);
        zip.file(file.name, finalContent);
      }

      const blob = await zip.generateAsync({ type: "blob" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "templated_emails.zip";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showButtonFeedback(processTemplateBtn, "Downloaded!");
    } catch (error) {
      showButtonFeedback(processTemplateBtn, "Error occurred!");
      console.error(error);
    }
  }

  transformBtn.addEventListener('click', () => processFiles(false));
  ipBtn.addEventListener('click', () => processFiles(true));
  processTemplateBtn.addEventListener('click', processWithTemplate);
}

// =============================================
// MBOX CONVERTER
// =============================================
function initMboxConverter() {
  const fileInput = document.getElementById('mboxFileInput');
  const convertBtn = document.getElementById('mboxConvertBtn');
  const progress = document.getElementById('progress');
  const progressCount = document.getElementById('progressCount');
  const resultsDiv = document.getElementById('mboxResults');
  const downloadAllBtn = document.getElementById('mboxDownloadAll');

  convertBtn.addEventListener('click', async () => {
    await convertMboxToEml();
    showButtonFeedback(convertBtn, "Processing...");
  });
  
  downloadAllBtn.addEventListener('click', async () => {
    await downloadAllAsZip();
    showButtonFeedback(downloadAllBtn, "Downloading...");
  });

  async function convertMboxToEml() {
    resultsDiv.innerHTML = '';
    downloadAllBtn.style.display = 'none';
    
    if (fileInput.files.length === 0) {
      showButtonFeedback(convertBtn, "Add MBOX content!");
      return;
    }
    
    progress.style.display = 'block';
    
    try {
      const files = [];
      const file = fileInput.files[0];
      
      if (file.name.endsWith('.zip')) {
        const zip = await JSZip.loadAsync(file);
        for (const [relativePath, zipEntry] of Object.entries(zip.files)) {
          if (!zipEntry.dir && zipEntry.name.endsWith('.mbox')) {
            const content = await zipEntry.async('text');
            files.push({
              name: zipEntry.name.split('/').pop(),
              content: content
            });
          }
        }
      } else if (file.name.endsWith('.mbox')) {
        const content = await file.text();
        files.push({
          name: file.name,
          content: content
        });
      }

      if (files.length === 0) {
        resultsDiv.innerHTML = '<p>No valid MBOX files found</p>';
        progress.style.display = 'none';
        showButtonFeedback(convertBtn, "No files found!");
        return;
      }

      const zip = new JSZip();
      let count = 0;
      
      for (const file of files) {
        const messages = parseMbox(file.content);
        progressCount.textContent = messages.length;
        
        if (messages.length === 0) {
          resultsDiv.innerHTML = '<p>No messages found in the MBOX file.</p>';
          progress.style.display = 'none';
          showButtonFeedback(convertBtn, "No messages!");
          return;
        }
        
        for (const message of messages) {
          const emlContent = message.raw;
          
          let subject = extractHeader(emlContent, 'Subject') || `No_Subject_${count + 1}`;
          
          const cleanSubject = subject
            .replace(/[^\w\s-]/g, '')
            .replace(/\s+/g, ' ')
            .trim()
            .substring(0, 100)
            .replace(/\s/g, '_');
          
          const filename = `${cleanSubject}_${count + 1}.eml`;
          
          const blob = new Blob([emlContent], { type: 'message/rfc822' });
          const url = URL.createObjectURL(blob);
          
          const messageDiv = document.createElement('div');
          messageDiv.className = 'message-info';
          
          const link = document.createElement('a');
          link.href = url;
          link.download = filename;
          link.textContent = `Download: ${filename}`;
          link.className = 'download-link';
          
          const details = document.createElement('div');
          details.className = 'message-details';
          details.textContent = `Subject: ${subject}`;
          
          messageDiv.appendChild(link);
          messageDiv.appendChild(details);
          resultsDiv.appendChild(messageDiv);
          
          zip.file(filename, emlContent);
          
          count++;
          progressCount.textContent = count;
        }
      }
      
      progress.style.display = 'none';
      
      if (count > 0) {
        window.mboxZip = zip;
        downloadAllBtn.style.display = 'block';
      }
      
      showButtonFeedback(convertBtn, "Conversion done!");
    } catch (error) {
      console.error('Error:', error);
      resultsDiv.innerHTML = `<p style="color: red;">Error processing MBOX file: ${error.message}</p>`;
      progress.style.display = 'none';
      showButtonFeedback(convertBtn, "Error occurred!");
    }
  }
  
  function parseMbox(content) {
    const messages = [];
    const lines = content.split(/\r?\n/);
    let currentMessage = [];
    let inMessage = false;
    
    for (const line of lines) {
      if (line.startsWith('From ') && currentMessage.length > 0) {
        messages.push({ raw: currentMessage.join('\n') });
        currentMessage = [line];
        inMessage = true;
      } else if (line.startsWith('From ') && !inMessage) {
        currentMessage = [line];
        inMessage = true;
      } else if (inMessage) {
        currentMessage.push(line);
      }
    }
    
    if (currentMessage.length > 0) {
      messages.push({ raw: currentMessage.join('\n') });
    }
    
    return messages;
  }
  
  function extractHeader(emailContent, headerName) {
    const headerRegex = new RegExp(`^${headerName}:\\s*(.*)$`, 'im');
    const match = emailContent.match(headerRegex);
    return match ? match[1].trim() : null;
  }
  
  async function downloadAllAsZip() {
    if (!window.mboxZip) {
      showButtonFeedback(downloadAllBtn, "Nothing to download!");
      return;
    }
    
    const content = await window.mboxZip.generateAsync({ type: 'blob' });
    const url = URL.createObjectURL(content);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'converted_emails.zip';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    showButtonFeedback(downloadAllBtn, "Downloaded!");
  }
}

// =============================================
// BULK HEADER REMOVER
// =============================================
function initBulkRemover() {
  const dropArea = document.getElementById('removerUploadArea');
  const fileInput = document.getElementById('removerFileInput');
  const transformBtn = document.getElementById('removerTransformBtn');
  const templateBtn = document.getElementById('removerTemplateBtn');
  const templateContainer = document.getElementById('removerTemplateContainer');
  const processTemplateBtn = document.getElementById('removerProcessTemplateBtn');
  const resultsArea = document.getElementById('removerResults');

  let filesToProcess = [];

  templateBtn.addEventListener('click', () => {
    const show = templateContainer.style.display === 'block';
    templateContainer.style.display = show ? 'none' : 'block';
    showButtonFeedback(templateBtn, show ? "Template Hidden" : "Template Shown");
  });

  ["dragenter", "dragover"].forEach(event => {
    dropArea.addEventListener(event, e => {
      e.preventDefault();
      e.stopPropagation();
      dropArea.classList.add("dragover");
    });
  });

  ["dragleave", "drop"].forEach(event => {
    dropArea.addEventListener(event, e => {
      e.preventDefault();
      e.stopPropagation();
      dropArea.classList.remove("dragover");
    });
  });

  dropArea.addEventListener("drop", e => {
    e.preventDefault();
    e.stopPropagation();
    fileInput.files = e.dataTransfer.files;
    handleFileSelection();
  });

  fileInput.addEventListener("change", handleFileSelection);

  async function handleFileSelection() {
    filesToProcess = [];
    const files = Array.from(fileInput.files);
    
    if (files.length === 0) {
      resultsArea.innerHTML = '<p>No files selected</p>';
      return;
    }

    resultsArea.innerHTML = '<p>Processing files...</p>';
    
    try {
      for (const file of files) {
        if (file.name.endsWith('.zip')) {
          const zip = await JSZip.loadAsync(file);
          for (const [relativePath, zipEntry] of Object.entries(zip.files)) {
            if (!zipEntry.dir && (zipEntry.name.endsWith('.eml') || zipEntry.name.endsWith('.txt'))) {
              const content = await zipEntry.async('text');
              filesToProcess.push({
                name: zipEntry.name.split('/').pop(),
                content: content
              });
            }
          }
        } else if (file.name.endsWith('.eml') || file.name.endsWith('.txt')) {
          const content = await file.text();
          filesToProcess.push({
            name: file.name,
            content: content
          });
        }
      }

      updateFileList();
      showButtonFeedback(transformBtn, `${filesToProcess.length} files ready`);
    } catch (error) {
      resultsArea.innerHTML = `<p style="color:red;">Error processing files: ${error.message}</p>`;
      console.error(error);
    }
  }

  function updateFileList() {
    if (filesToProcess.length === 0) {
      resultsArea.innerHTML = '<p>No valid EML or TXT files found</p>';
      return;
    }

    resultsArea.innerHTML = `
      <p><strong>Selected files:</strong> ${filesToProcess.length}</p>
      <ul style="margin-top: 0.5rem; max-height: 200px; overflow-y: auto;">
        ${filesToProcess.map(file => `<li>${file.name}</li>`).join('')}
      </ul>
    `;
  }

  function extractBody(content) {
    if (content.includes('Return-Path:') || content.includes('From:')) {
      let headerEnd = content.indexOf('\r\n\r\n');
      if (headerEnd !== -1) return content.slice(headerEnd + 4).trim();
      headerEnd = content.indexOf('\n\n');
      if (headerEnd !== -1) return content.slice(headerEnd + 2).trim();
    }
    
    const htmlStart = content.indexOf('<');
    if (htmlStart !== -1) return content.slice(htmlStart).trim();
    
    return content;
  }

  async function processFiles() {
    if (filesToProcess.length === 0) {
      showButtonFeedback(transformBtn, "Upload files first!");
      return;
    }

    try {
      const zip = new JSZip();
      
      for (const file of filesToProcess) {
        const body = extractBody(file.content);
        if (body) {
          const name = file.name.replace(/\.(eml|txt)$/i, '_body.txt');
          zip.file(name, body);
        } else {
          resultsArea.innerHTML += `<p style="color:red;">No body content: ${file.name}</p>`;
        }
      }

      const blob = await zip.generateAsync({ type: "blob" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "email_bodies_only.zip";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showButtonFeedback(transformBtn, "Downloaded!");
    } catch (error) {
      showButtonFeedback(transformBtn, "Error occurred!");
      console.error(error);
    }
  }

  async function processWithTemplate() {
    if (filesToProcess.length === 0) {
      showButtonFeedback(processTemplateBtn, "Upload files first!");
      return;
    }

    const template = document.getElementById("removerTemplateInput").value;
    if (!template) {
      showButtonFeedback(processTemplateBtn, "Enter template first!");
      return;
    }

    if (!template.includes("[newsletter]")) {
      showButtonFeedback(processTemplateBtn, 'Add "[newsletter]"!');
      return;
    }

    try {
      const zip = new JSZip();
      
      for (const file of filesToProcess) {
        const body = extractBody(file.content);
        const final = template.replace("[newsletter]", body);
        zip.file(file.name, final);
      }

      const blob = await zip.generateAsync({ type: "blob" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "templated_emails.zip";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showButtonFeedback(processTemplateBtn, "Downloaded!");
    } catch (error) {
      showButtonFeedback(processTemplateBtn, "Error occurred!");
      console.error(error);
    }
  }

  transformBtn.addEventListener('click', processFiles);
  processTemplateBtn.addEventListener('click', processWithTemplate);
}

// =============================================
// SINGLE HEADER REMOVER
// =============================================
function initSingleRemover() {
  const inputText = document.getElementById('singleRemoverInput');
  const templateInput = document.getElementById('singleRemoverTemplate');
  const outputDiv = document.getElementById('singleRemoverOutput');
  const templateOutputDiv = document.getElementById('singleRemoverTemplateOutput');
  const removeBtn = document.getElementById('singleRemoverBtn');
  const copyBtn = document.getElementById('copyNormalOutput');
  const templateCopyBtn = document.getElementById('copyTemplateOutput');
  const clearBtn = document.getElementById('singleRemoverClearBtn');
  
  removeBtn.addEventListener('click', removeHeaders);
  copyBtn.addEventListener('click', () => handleCopy(outputDiv, copyBtn));
  templateCopyBtn.addEventListener('click', () => handleCopy(templateOutputDiv, templateCopyBtn));
  clearBtn.addEventListener('click', clearAll);
  
  function removeHeaders() {
    if (!inputText.value.trim()) {
      showButtonFeedback(removeBtn, "Paste content first!");
      return;
    }
    
    const content = inputText.value;
    let output = removeEmailHeaders(content);
    
    outputDiv.textContent = output;
    
    const template = templateInput.value.trim();
    if (template) {
      if (!template.includes("[newsletter]")) {
        showButtonFeedback(removeBtn, 'Add "[newsletter]"!');
        templateOutputDiv.textContent = "Template must contain [newsletter] placeholder";
        return;
      }
      templateOutputDiv.textContent = template.replace("[newsletter]", output);
    } else {
      templateOutputDiv.textContent = "No template provided";
    }
    
    showButtonFeedback(removeBtn, "Headers removed!");
  }
  
  function removeEmailHeaders(content) {
    let headerEnd = content.indexOf('\r\n\r\n');
    if (headerEnd !== -1) {
      return content.slice(headerEnd + 4).trim();
    }
    
    headerEnd = content.indexOf('\n\n');
    if (headerEnd !== -1) {
      return content.slice(headerEnd + 2).trim();
    }
    
    const htmlStart = content.indexOf('<');
    if (htmlStart !== -1) {
      return content.slice(htmlStart).trim();
    }
    
    return content;
  }
  
  function handleCopy(outputElement, button) {
    if (!outputElement.textContent.trim() || 
        outputElement.textContent === "No template provided") {
      showButtonFeedback(button, "Nothing to copy!");
      return;
    }
    
    const tempTextarea = document.createElement('textarea');
    tempTextarea.value = outputElement.textContent;
    document.body.appendChild(tempTextarea);
    tempTextarea.select();
    document.execCommand('copy');
    document.body.removeChild(tempTextarea);
    
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check"></i> Copied!';
    button.disabled = true;
    
    setTimeout(() => {
      button.innerHTML = originalText;
      button.disabled = false;
    }, 2000);
  }
  
  function clearAll() {
    inputText.value = '';
    templateInput.value = '';
    outputDiv.textContent = '';
    templateOutputDiv.textContent = '';
    showButtonFeedback(clearBtn, "Cleared!");
  }
}

// =============================================
// SINGLE RECEIVED EXTRACTOR
// =============================================
function initSingleReceivedExtractor() {
  const extractBtn = document.getElementById('singleReceivedExtractBtn');
  const copyBtn = document.getElementById('singleReceivedCopyBtn');
  const clearBtn = document.getElementById('singleReceivedClearBtn');
  const inputText = document.getElementById('singleReceivedInput');
  const outputDiv = document.getElementById('singleReceivedOutput');

  extractBtn.addEventListener('click', extractReceivedHeaders);
  copyBtn.addEventListener('click', copyReceivedHeaders);
  clearBtn.addEventListener('click', clearAll);

  function extractReceivedHeaders() {
    const content = inputText.value.trim();
    if (!content) {
      showButtonFeedback(extractBtn, "Paste content first!");
      return;
    }

    const receivedHeaders = content.match(/^Received:[^\n]*(\n\s+[^\n]*)*/gmi);
    
    if (!receivedHeaders || receivedHeaders.length === 0) {
      outputDiv.textContent = "No Received headers found";
      return;
    }

    const formattedHeaders = receivedHeaders.map(header => {
      const cleanedHeader = header.replace(/^Received:\s*/i, '');
      return `Received:${cleanedHeader.replace(/\n/g, '\n        ')}`;
    }).join('\n');

    outputDiv.textContent = formattedHeaders;
    showButtonFeedback(extractBtn, "Received headers extracted!");
  }

  function copyReceivedHeaders() {
    if (!outputDiv.textContent.trim() || outputDiv.textContent === "No Received headers found") {
      showButtonFeedback(copyBtn, "Nothing to copy!");
      return;
    }
    
    const tempTextarea = document.createElement('textarea');
    tempTextarea.value = outputDiv.textContent;
    document.body.appendChild(tempTextarea);
    tempTextarea.select();
    document.execCommand('copy');
    document.body.removeChild(tempTextarea);
    showButtonFeedback(copyBtn, "Copied!");
  }

  function clearAll() {
    inputText.value = '';
    outputDiv.textContent = '';
    showButtonFeedback(clearBtn, "Cleared!");
  }
}

// =============================================
// BULK RECEIVED EXTRACTOR
// =============================================
function initBulkReceivedExtractor() {
  const dropArea = document.getElementById('bulkReceivedUploadArea');
  const fileInput = document.getElementById('bulkReceivedFileInput');
  const extractBtn = document.getElementById('bulkReceivedExtractBtn');
  const downloadBtn = document.getElementById('bulkReceivedDownloadBtn');
  const clearBtn = document.getElementById('bulkReceivedClearBtn');
  const resultsArea = document.getElementById('bulkReceivedResults');

  let filesToProcess = [];

  ["dragenter", "dragover"].forEach(event => {
    dropArea.addEventListener(event, e => {
      e.preventDefault();
      e.stopPropagation();
      dropArea.classList.add("dragover");
    });
  });

  ["dragleave", "drop"].forEach(event => {
    dropArea.addEventListener(event, e => {
      e.preventDefault();
      e.stopPropagation();
      dropArea.classList.remove("dragover");
    });
  });

  dropArea.addEventListener("drop", e => {
    e.preventDefault();
    e.stopPropagation();
    fileInput.files = e.dataTransfer.files;
    handleFileSelection();
  });

  fileInput.addEventListener("change", handleFileSelection);

  async function handleFileSelection() {
    filesToProcess = [];
    const files = Array.from(fileInput.files);
    
    if (files.length === 0) {
      resultsArea.innerHTML = '<p>No files selected</p>';
      return;
    }

    resultsArea.innerHTML = '<p>Processing files...</p>';
    
    try {
      for (const file of files) {
        if (file.name.endsWith('.zip')) {
          const zip = await JSZip.loadAsync(file);
          for (const [relativePath, zipEntry] of Object.entries(zip.files)) {
            if (!zipEntry.dir && (zipEntry.name.endsWith('.eml') || zipEntry.name.endsWith('.txt'))) {
              const content = await zipEntry.async('text');
              filesToProcess.push({
                name: zipEntry.name.split('/').pop(),
                content: content
              });
            }
          }
        } else if (file.name.endsWith('.eml') || file.name.endsWith('.txt')) {
          const content = await file.text();
          filesToProcess.push({
            name: file.name,
            content: content
          });
        }
      }

      updateFileList();
      showButtonFeedback(extractBtn, `${filesToProcess.length} files ready`);
    } catch (error) {
      resultsArea.innerHTML = `<p style="color:red;">Error processing files: ${error.message}</p>`;
      console.error(error);
    }
  }

  function updateFileList() {
    if (filesToProcess.length === 0) {
      resultsArea.innerHTML = '<p>No valid EML or TXT files found</p>';
      return;
    }

    resultsArea.innerHTML = `
      <p><strong>Selected files:</strong> ${filesToProcess.length}</p>
      <ul style="margin-top: 0.5rem; max-height: 200px; overflow-y: auto;">
        ${filesToProcess.map(file => `<li>${file.name}</li>`).join('')}
      </ul>
    `;
  }

  function extractReceivedHeaders(content) {
    const receivedHeaders = content.match(/^Received:[^\n]*(\n\s+[^\n]*)*/gmi);
    
    if (!receivedHeaders || receivedHeaders.length === 0) {
      return null;
    }

    return receivedHeaders.map(header => {
      const cleanedHeader = header.replace(/^Received:\s*/i, '');
      return `Received:${cleanedHeader.replace(/\n/g, '\n        ')}`;
    }).join('\n');
  }

  function extractEmailInfo(content) {
    const fromMatch = content.match(/^From:.*?<([^>]+)>/mi) || content.match(/^From:\s*([^\s@]+@[^\s]+)/mi);
    const fromEmail = fromMatch ? fromMatch[1] : 'unknown';
    
    const subjectMatch = content.match(/^Subject:\s*(.*)/mi);
    const subject = subjectMatch ? subjectMatch[1].replace(/[^\w\s-]/g, '').substring(0, 50) : 'no subject';
    
    const dateMatch = content.match(/^Date:\s*(.*)/mi);
    const date = dateMatch ? new Date(dateMatch[1]).toISOString().split('T')[0] : 'no date';
    
    return {
      from: fromEmail,
      subject: subject,
      date: date
    };
  }

  async function processFiles() {
    if (filesToProcess.length === 0) {
      showButtonFeedback(extractBtn, "Upload files first!");
      return;
    }

    try {
      let allHeaders = '';
      
      for (const file of filesToProcess) {
        const headers = extractReceivedHeaders(file.content);
        if (headers) {
          const info = extractEmailInfo(file.content);
          const fileName = `${info.subject} (${info.from}) - ${info.date}.eml`;
          
          allHeaders += `=== ${fileName} ===\n${headers}\n\n`;
        }
      }

      if (!allHeaders.trim()) {
        showButtonFeedback(extractBtn, "No Received headers found!");
        return;
      }

      const blob = new Blob([allHeaders], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "all_received_headers.txt";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showButtonFeedback(extractBtn, "Downloaded!");
    } catch (error) {
      showButtonFeedback(extractBtn, "Error occurred!");
      console.error(error);
    }
  }

  function clearAll() {
    fileInput.value = '';
    filesToProcess = [];
    resultsArea.innerHTML = '';
    showButtonFeedback(clearBtn, "Cleared!");
  }

  extractBtn.addEventListener('click', processFiles);
  downloadBtn.addEventListener('click', processFiles);
  clearBtn.addEventListener('click', clearAll);
}

// =============================================
// TEXT COMBINER TOOL
// =============================================
function initTextCombiner() {
  const dropArea = document.getElementById('combinerUploadArea');
  const fileInput = document.getElementById('combinerFileInput');
  const combineBtn = document.getElementById('combineBtn');
  const clearBtn = document.getElementById('combinerClearBtn');
  const resultsArea = document.getElementById('combinerResults');

  let filesToProcess = [];

  ["dragenter", "dragover"].forEach(event => {
    dropArea.addEventListener(event, e => {
      e.preventDefault();
      e.stopPropagation();
      dropArea.classList.add("dragover");
    });
  });

  ["dragleave", "drop"].forEach(event => {
    dropArea.addEventListener(event, e => {
      e.preventDefault();
      e.stopPropagation();
      dropArea.classList.remove("dragover");
    });
  });

  dropArea.addEventListener("drop", e => {
    e.preventDefault();
    e.stopPropagation();
    fileInput.files = e.dataTransfer.files;
    handleFileSelection();
  });

  fileInput.addEventListener("change", handleFileSelection);

  async function handleFileSelection() {
    filesToProcess = [];
    const files = Array.from(fileInput.files);
    
    if (files.length === 0) {
      resultsArea.innerHTML = '<p>No files selected</p>';
      return;
    }

    resultsArea.innerHTML = '<p>Processing files...</p>';
    
    try {
      for (const file of files) {
        if (file.name.endsWith('.zip')) {
          const zip = await JSZip.loadAsync(file);
          for (const [relativePath, zipEntry] of Object.entries(zip.files)) {
            if (!zipEntry.dir && (zipEntry.name.endsWith('.txt') || !zipEntry.name.includes('.'))) {
              const content = await zipEntry.async('text');
              filesToProcess.push({
                name: zipEntry.name.split('/').pop(),
                content: content.trim()
              });
            }
          }
        } else if (file.name.endsWith('.txt') || !file.name.includes('.')) {
          const content = await file.text();
          filesToProcess.push({
            name: file.name,
            content: content.trim()
          });
        }
      }

      updateFileList();
      showButtonFeedback(combineBtn, `${filesToProcess.length} files ready`);
    } catch (error) {
      resultsArea.innerHTML = `<p style="color:red;">Error processing files: ${error.message}</p>`;
      console.error(error);
    }
  }

  function updateFileList() {
    if (filesToProcess.length === 0) {
      resultsArea.innerHTML = '<p>No valid text files found</p>';
      return;
    }

    resultsArea.innerHTML = `
      <p><strong>Selected files:</strong> ${filesToProcess.length}</p>
      <ul style="margin-top: 0.5rem; max-height: 200px; overflow-y: auto;">
        ${filesToProcess.map(file => `<li>${file.name}</li>`).join('')}
      </ul>
    `;
  }

  async function combineFiles() {
    if (filesToProcess.length === 0) {
      showButtonFeedback(combineBtn, "Upload files first!");
      return;
    }

    try {
      let combinedContent = '';
      filesToProcess.forEach((file, index) => {
        combinedContent += file.content;
        if (index < filesToProcess.length - 1) {
          combinedContent += '\n\n__SEP__\n\n';
        }
      });

      const blob = new Blob([combinedContent], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "combined_files.txt";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showButtonFeedback(combineBtn, "Downloaded!");
    } catch (error) {
      showButtonFeedback(combineBtn, "Error occurred!");
      console.error(error);
    }
  }

  function clearAll() {
    fileInput.value = '';
    filesToProcess = [];
    resultsArea.innerHTML = '';
    showButtonFeedback(clearBtn, "Cleared!");
  }

  combineBtn.addEventListener('click', combineFiles);
  clearBtn.addEventListener('click', clearAll);
}

// =============================================
// DOMAIN & IP EXTRACTOR
// =============================================
function initDomainExtractor() {
  const extractBtn = document.getElementById('domainExtractorBtn');
  const copyBtn = document.getElementById('domainExtractorCopyBtn');
  const clearBtn = document.getElementById('domainExtractorClearBtn');
  const inputText = document.getElementById('domainExtractorInput');
  const outputDiv = document.getElementById('domainExtractorOutput');

  extractBtn.addEventListener('click', extractDomains);
  copyBtn.addEventListener('click', copyContent);
  clearBtn.addEventListener('click', clearContent);

  function extractDomains() {
    const text = inputText.value.trim();
    if (!text) {
      showButtonFeedback(extractBtn, "Enter text first!");
      return;
    }

    const ipPattern = /\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/g;
    const domainPattern = /\b((?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z]{2,})\b/gi;

    const allIPs = [...new Set(text.match(ipPattern) || [])];
    const allDomains = [...new Set(text.match(domainPattern) || [])];

    const domainMap = {};
    
    allDomains.forEach(domain => {
      const domainRegex = new RegExp(`\\b${domain}\\b`, 'gi');
      let match;
      const domainIPs = new Set();
      
      while ((match = domainRegex.exec(text)) !== null) {
        const startPos = Math.max(0, match.index - 50);
        const endPos = Math.min(text.length, match.index + domain.length + 50);
        const context = text.slice(startPos, endPos);
        
        const ipsInContext = context.match(ipPattern) || [];
        ipsInContext.forEach(ip => domainIPs.add(ip));
      }
      
      if (domainIPs.size > 0) {
        domainMap[domain] = Array.from(domainIPs);
      }
    });

    const usedIPs = Object.values(domainMap).flat();
    const unassociatedIPs = allIPs.filter(ip => !usedIPs.includes(ip));

    let output = '';
    
    for (const [domain, ipList] of Object.entries(domainMap)) {
      output += `${domain}\n`;
      output += `${ipList.join('\n')}\n\n`;
    }

    if (unassociatedIPs.length > 0) {
      output += `Unassociated IPs:\n${unassociatedIPs.join('\n')}\n`;
    }

    outputDiv.textContent = output.trim();
    showButtonFeedback(extractBtn, "Extracted!");
  }

  function copyContent() {
    if (!outputDiv.textContent.trim()) {
      showButtonFeedback(copyBtn, "Nothing to copy!");
      return;
    }
    
    const tempInput = document.createElement('textarea');
    tempInput.value = outputDiv.textContent;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    showButtonFeedback(copyBtn, "Copied!");
  }

  function clearContent() {
    inputText.value = '';
    outputDiv.textContent = '';
    showButtonFeedback(clearBtn, "Cleared!");
  }
}

// =============================================
// DNS RECORD GENERATOR
// =============================================
function initDnsGenerator() {
  document.querySelectorAll('.dns-tab').forEach(tab => {
    tab.addEventListener('click', function() {
      const tabId = this.getAttribute('data-tab');
      
      document.querySelectorAll('.dns-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.dns-tab-content').forEach(c => c.classList.remove('active'));
      
      this.classList.add('active');
      document.getElementById(`${tabId}-tab`).classList.add('active');
    });
  });

  // SPF Generator Functions
  window.generateSpfRecords = function() {
    const domains = document.getElementById('spf-domains').value.split('\n')
      .map(domain => domain.trim())
      .filter(domain => domain.length > 0);
    
    if (domains.length === 0) {
      showSpfStatus('Please enter at least one domain', 'error');
      updateSpfStats(0, 0);
      return;
    }
    
    let ipInput = document.getElementById('spf-ips').value;
    ipInput = ipInput.replace(/,/g, ' ');
    ipInput = ipInput.replace(/\s+/g, ' ');
    const ipArray = ipInput.trim().split(' ').filter(ip => ip.trim() !== '');
    
    if (ipArray.length === 0) {
      showSpfStatus('Please enter at least one IP address', 'error');
      updateSpfStats(0, 0);
      return;
    }
    
    const validIPs = [];
    const invalidIPs = [];
    
    ipArray.forEach(ip => {
      if (isValidIP(ip)) {
        validIPs.push(ip);
      } else {
        invalidIPs.push(ip);
      }
    });
    
    if (validIPs.length === 0) {
      showSpfStatus('No valid IP addresses found', 'error');
      updateSpfStats(0, 0);
      return;
    }
    
    if (invalidIPs.length > 0) {
      showSpfStatus(`Generated records with ${invalidIPs.length} invalid IP(s) ignored`, 'warning');
    } else {
      showSpfStatus(`Successfully generated ${domains.length} SPF records`, 'success');
    }
    
    const formattedIPs = validIPs.join(';');
    
    let resultHTML = '';
    domains.forEach(domain => {
      const dnsEntry = `dns.${domain}`;
      resultHTML += `
        <div class="record-item">
          <div class="record-content">${domain},${dnsEntry},TXT,Arecords:${formattedIPs}</div>
        </div>
      `;
    });
    
    if (invalidIPs.length > 0) {
      resultHTML += `
        <div class="record-item error">
          <div class="record-content">Invalid IPs: ${invalidIPs.join(', ')}</div>
        </div>
      `;
    }
    
    document.getElementById('spf-result').innerHTML = resultHTML;
    updateSpfStats(domains.length, invalidIPs.length);
  };
  
  window.generateSpfExternalRecords = function() {
    const domains = document.getElementById('spf-external-domains').value.split('\n')
      .map(domain => domain.trim())
      .filter(domain => domain.length > 0);
    
    if (domains.length === 0) {
      showSpfExternalStatus('Please enter at least one domain', 'error');
      updateSpfExternalStats(0, 0);
      return;
    }
    
    let ipInput = document.getElementById('spf-external-ips').value;
    ipInput = ipInput.replace(/,/g, ' ');
    ipInput = ipInput.replace(/\s+/g, ' ');
    const ipArray = ipInput.trim().split(' ').filter(ip => ip.trim() !== '');
    
    if (ipArray.length === 0) {
      showSpfExternalStatus('Please enter at least one IP address', 'error');
      updateSpfExternalStats(0, 0);
      return;
    }
    
    const validIPs = [];
    const invalidIPs = [];
    
    ipArray.forEach(ip => {
      if (isValidIP(ip)) {
        validIPs.push(ip);
      } else {
        invalidIPs.push(ip);
      }
    });
    
    if (validIPs.length === 0) {
      showSpfExternalStatus('No valid IP addresses found', 'error');
      updateSpfExternalStats(0, 0);
      return;
    }
    
    if (invalidIPs.length > 0) {
      showSpfExternalStatus(`Generated records with ${invalidIPs.length} invalid IP(s) ignored`, 'warning');
    } else {
      showSpfExternalStatus(`Successfully generated ${domains.length} SPF records`, 'success');
    }
    
    const formattedIPs = validIPs.map(ip => `ip4:${ip}`).join(' ');
    
    let resultHTML = '';
    domains.forEach(domain => {
      const spfRecord = `v=spf1 ${formattedIPs} ~all`;
      resultHTML += `
        <div class="record-item">
          <div class="record-content">${domain},${domain},TXT,${spfRecord}</div>
        </div>
      `;
    });
    
    if (invalidIPs.length > 0) {
      resultHTML += `
        <div class="record-item error">
          <div class="record-content">Invalid IPs: ${invalidIPs.join(', ')}</div>
        </div>
      `;
    }
    
    document.getElementById('spf-external-result').innerHTML = resultHTML;
    updateSpfExternalStats(domains.length, invalidIPs.length);
  };
  
  window.clearSpfExternalInputs = function() {
    document.getElementById('spf-external-domains').value = '';
    document.getElementById('spf-external-ips').value = '';
    document.getElementById('spf-external-result').innerHTML = '';
    document.getElementById('spf-external-stats').innerHTML = '';
    showSpfExternalStatus('Ready to generate SPF records in external format', 'info');
  };
  
  window.copySpfExternalToClipboard = function() {
    const resultElements = document.querySelectorAll('#spf-external-result .record-content');
    if (resultElements.length === 0) {
      showSpfExternalStatus('Nothing to copy', 'error');
      return;
    }
    
    let textToCopy = '';
    resultElements.forEach(el => {
      if (!el.closest('.error')) {
        textToCopy += el.textContent + '\n';
      }
    });
    
    navigator.clipboard.writeText(textToCopy.trim())
      .then(() => showSpfExternalStatus('Records copied!', 'success'))
      .catch(err => showSpfExternalStatus('Failed to copy: ' + err, 'error'));
  };
  
  window.downloadSpfExternalRecords = function() {
    const resultElements = document.querySelectorAll('#spf-external-result .record-content');
    if (resultElements.length === 0) {
      showSpfExternalStatus('Nothing to save', 'error');
      return;
    }
    
    let textToDownload = '';
    resultElements.forEach(el => {
      if (!el.closest('.error')) {
        textToDownload += el.textContent + '\n';
      }
    });
    
    const blob = new Blob([textToDownload.trim()], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'spf-external-records.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showSpfExternalStatus('Records saved!', 'success');
  };
  
  window.showSpfExternalStatus = function(message, type) {
    const statusElement = document.getElementById('spf-external-statusMessage');
    statusElement.className = `status ${type}`;
    statusElement.innerHTML = `
      <i class="fas ${
        type === 'success' ? 'fa-check-circle' : 
        type === 'error' ? 'fa-times-circle' : 
        type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'
      }"></i>
      <span>${message}</span>
    `;
  };
  
  window.updateSpfExternalStats = function(successCount, errorCount) {
    const statsElement = document.getElementById('spf-external-stats');
    statsElement.innerHTML = `
      <div class="stat-item">
        <i class="fas fa-check-circle stat-success"></i>
        <span>Valid: <span class="stat-value stat-success">${successCount}</span></span>
      </div>
      ${errorCount > 0 ? `
      <div class="stat-item">
        <i class="fas fa-exclamation-circle stat-error"></i>
        <span>Invalid: <span class="stat-value stat-error">${errorCount}</span></span>
      </div>
      ` : ''}
    `;
  };
  
  window.isValidIP = function(ip) {
    const ipv4Regex = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
    return ipv4Regex.test(ip);
  };
  
  window.updateSpfStats = function(successCount, errorCount) {
    const statsElement = document.getElementById('spf-stats');
    statsElement.innerHTML = `
      <div class="stat-item">
        <i class="fas fa-check-circle stat-success"></i>
        <span>Valid: <span class="stat-value stat-success">${successCount}</span></span>
      </div>
      ${errorCount > 0 ? `
      <div class="stat-item">
        <i class="fas fa-exclamation-circle stat-error"></i>
        <span>Invalid: <span class="stat-value stat-error">${errorCount}</span></span>
      </div>
      ` : ''}
    `;
  };
  
  window.clearSpfInputs = function() {
    document.getElementById('spf-domains').value = '';
    document.getElementById('spf-ips').value = '';
    document.getElementById('spf-result').innerHTML = '';
    document.getElementById('spf-stats').innerHTML = '';
    showSpfStatus('Ready to generate SPF records', 'info');
  };
  
  window.copySpfToClipboard = function() {
    const resultElements = document.querySelectorAll('#spf-result .record-content');
    if (resultElements.length === 0) {
      showSpfStatus('Nothing to copy', 'error');
      return;
    }
    
    let textToCopy = '';
    resultElements.forEach(el => {
      if (!el.closest('.error')) {
        textToCopy += el.textContent + '\n';
      }
    });
    
    navigator.clipboard.writeText(textToCopy.trim())
      .then(() => showSpfStatus('Records copied!', 'success'))
      .catch(err => showSpfStatus('Failed to copy: ' + err, 'error'));
  };
  
  window.downloadSpfRecords = function() {
    const resultElements = document.querySelectorAll('#spf-result .record-content');
    if (resultElements.length === 0) {
      showSpfStatus('Nothing to save', 'error');
      return;
    }
    
    let textToDownload = '';
    resultElements.forEach(el => {
      if (!el.closest('.error')) {
        textToDownload += el.textContent + '\n';
      }
    });
    
    const blob = new Blob([textToDownload.trim()], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'spf-records.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showSpfStatus('Records saved!', 'success');
  };
  
  window.showSpfStatus = function(message, type) {
    const statusElement = document.getElementById('spf-statusMessage');
    statusElement.className = `status ${type}`;
    statusElement.innerHTML = `
      <i class="fas ${
        type === 'success' ? 'fa-check-circle' : 
        type === 'error' ? 'fa-times-circle' : 
        type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'
      }"></i>
      <span>${message}</span>
    `;
  };
  
  // TXT Generator Functions
  window.generateTxtRecords = function() {
    const inputText = document.getElementById('txt-input').value;
    const lines = inputText.split('\n');
    let successCount = 0;
    let errorCount = 0;
    let resultHTML = '';
    
    for (const line of lines) {
      if (line.trim() === '') continue;
      
      try {
        const normalized = line.replace(/,/g, ' ');
        const parts = normalized.split(/\s+/).filter(part => part !== '');
        
        if (parts.length < 2) {
          throw new Error('Invalid format - needs domain and verification data');
        }
        
        const domain = parts[0];
        let verificationParts = [];
        let verificationStarted = false;
        
        for (const part of parts.slice(1)) {
          if (part === domain && !verificationStarted) {
            continue;
          }
          verificationStarted = true;
          verificationParts.push(part);
        }
        
        const verification = verificationParts.join(' ').trim();
        
        if (!verification) {
          throw new Error('Missing verification phrase');
        }
        
        const txtRecord = `${domain},${domain},TXT,${verification}`;
        
        resultHTML += `
          <div class="record-item">
            <div class="record-content">${txtRecord}</div>
          </div>
        `;
        
        successCount++;
      } catch (e) {
        resultHTML += `
          <div class="record-item error">
            <div class="record-content">Error: ${line}</div>
          </div>
        `;
        errorCount++;
      }
    }
    
    const resultElement = document.getElementById('txt-result');
    if (successCount === 0 && errorCount > 0) {
      resultElement.innerHTML = resultHTML;
      showTxtStatus('No valid records generated', 'error');
    } else if (errorCount > 0) {
      resultElement.innerHTML = resultHTML;
      showTxtStatus(`Generated ${successCount} records with ${errorCount} errors`, 'warning');
    } else if (successCount > 0) {
      resultElement.innerHTML = resultHTML;
      showTxtStatus(`Successfully generated ${successCount} TXT records`, 'success');
    } else {
      resultElement.innerHTML = '<div class="record-item">No valid input found</div>';
      showTxtStatus('Ready to generate TXT records', 'info');
    }
    
    updateTxtStats(successCount, errorCount);
  };
  
  window.updateTxtStats = function(successCount, errorCount) {
    const statsElement = document.getElementById('txt-stats');
    statsElement.innerHTML = `
      <div class="stat-item">
        <i class="fas fa-check-circle stat-success"></i>
        <span>Valid: <span class="stat-value stat-success">${successCount}</span></span>
      </div>
      ${errorCount > 0 ? `
      <div class="stat-item">
        <i class="fas fa-exclamation-circle stat-error"></i>
        <span>Errors: <span class="stat-value stat-error">${errorCount}</span></span>
      </div>
      ` : ''}
    `;
  };
  
  window.clearTxtInputs = function() {
    document.getElementById('txt-input').value = '';
    document.getElementById('txt-result').innerHTML = '';
    document.getElementById('txt-stats').innerHTML = '';
    showTxtStatus('Ready to generate TXT records', 'info');
  };
  
  window.copyTxtToClipboard = function() {
    const resultElements = document.querySelectorAll('#txt-result .record-content');
    if (resultElements.length === 0) {
      showTxtStatus('Nothing to copy', 'error');
      return;
    }
    
    let textToCopy = '';
    resultElements.forEach(el => {
      if (!el.closest('.error')) {
        textToCopy += el.textContent + '\n';
      }
    });
    
    if (textToCopy.trim() === '') {
      showTxtStatus('No valid records to copy', 'error');
      return;
    }
    
    navigator.clipboard.writeText(textToCopy.trim())
      .then(() => showTxtStatus('Records copied!', 'success'))
      .catch(err => showTxtStatus('Failed to copy: ' + err, 'error'));
  };
  
  window.downloadTxtRecords = function() {
    const resultElements = document.querySelectorAll('#txt-result .record-content');
    if (resultElements.length === 0) {
      showTxtStatus('Nothing to save', 'error');
      return;
    }
    
    let textToDownload = '';
    resultElements.forEach(el => {
      if (!el.closest('.error')) {
        textToDownload += el.textContent + '\n';
      }
    });
    
    if (textToDownload.trim() === '') {
      showTxtStatus('No valid records to save', 'error');
      return;
    }
    
    const blob = new Blob([textToDownload.trim()], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'txt-records.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showTxtStatus('Records saved!', 'success');
  };
  
  window.showTxtStatus = function(message, type) {
    const statusElement = document.getElementById('txt-statusMessage');
    statusElement.className = `status ${type}`;
    statusElement.innerHTML = `
      <i class="fas ${
        type === 'success' ? 'fa-check-circle' : 
        type === 'error' ? 'fa-times-circle' : 
        type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'
      }"></i>
      <span>${message}</span>
    `;
  };
}

// =============================================
// BACK TO TOP BUTTON
// =============================================
const backToTopBtn = document.getElementById('backToTopBtn');

window.addEventListener('scroll', function() {
  if (window.pageYOffset > 300) {
    backToTopBtn.classList.add('visible');
  } else {
    backToTopBtn.classList.remove('visible');
  }
});

backToTopBtn.addEventListener('click', function() {
  const activeSection = document.querySelector('.tool-section.active');
  if (activeSection) {
    clearToolData(activeSection.id);
    activeSection.classList.remove('active');
  }
  
  resetAllTools();
  
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
});

function resetAllTools() {
  document.querySelectorAll('textarea').forEach(textarea => {
    textarea.value = '';
  });
  
  document.querySelectorAll('.file-input').forEach(input => {
    input.value = '';
  });
  
  document.querySelectorAll('.results-area').forEach(area => {
    area.innerHTML = '';
  });
  
  document.querySelectorAll('.template-container').forEach(container => {
    container.style.display = 'none';
  });
  
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    if (radio.id.includes('Rdns')) {
      radio.checked = true;
    } else {
      radio.checked = false;
    }
  });
  
  document.getElementById('progress').style.display = 'none';
  document.getElementById('mboxDownloadAll').style.display = 'none';
}

// =============================================
// INITIALIZE ALL TOOLS
// =============================================
document.addEventListener('DOMContentLoaded', function() {
  initSingleTransformer();
  initBulkTransformer();
  initMboxConverter();
  initBulkRemover();
  initSingleRemover();
  initSingleReceivedExtractor();
  initBulkReceivedExtractor();
  initTextCombiner();
  initDomainExtractor();
  initDnsGenerator();
});
</script>
  
</body>
</html>
